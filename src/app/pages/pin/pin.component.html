<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="cancel()" fill="clear">
        <ion-icon name="arrow-back" slot="start"></ion-icon>
        إلغاء
      </ion-button>
    </ion-buttons>
    <ion-title>رمز PIN</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="ion-text-center ion-padding">
    <ion-icon name="lock-closed" size="large" color="primary"></ion-icon>
    <h2>أدخل رمز PIN</h2>
    <p>أدخل رمز PIN المكون من 4 أرقام للوصول إلى التطبيق</p>
  </div>

  <!-- PIN Display -->
  <div class="pin-display ion-text-center ion-margin">
    <div class="pin-dots">
      <span *ngFor="let i of [1,2,3,4]" 
            [class.filled]="i <= pinInput().length"
            class="pin-dot"></span>
    </div>
    <p class="pin-input">{{ pinInput() }}</p>
  </div>

  <!-- Numeric Keypad -->
  <ion-grid class="keypad">
    <ion-row>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('1')">
          1
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('2')">
          2
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('3')">
          3
        </ion-button>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('4')">
          4
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('5')">
          5
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('6')">
          6
        </ion-button>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('7')">
          7
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('8')">
          8
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('9')">
          9
        </ion-button>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="4">
        <ion-button expand="block" fill="clear" color="medium" (click)="clearPin()">
          مسح
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="outline" (click)="addDigit('0')">
          0
        </ion-button>
      </ion-col>
      <ion-col size="4">
        <ion-button expand="block" fill="clear" color="danger" (click)="removeDigit()">
          <ion-icon name="backspace" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Submit Button -->
  <div class="ion-padding">
    <ion-button 
      expand="block" 
      color="primary" 
      (click)="submitPin()"
      [disabled]="pinInput().length !== 4"
    >
      تأكيد
    </ion-button>
  </div>

  <!-- Error Message -->
  <div *ngIf="attempts() > 0" class="ion-text-center ion-padding">
    <ion-text color="danger">
      محاولات خاطئة: {{ attempts() }} من {{ maxAttempts }}
    </ion-text>
  </div>
</ion-content>

<!-- Error Alert -->
<ion-alert
  [isOpen]="showError()"
  header="خطأ"
  [message]="errorMessage()"
  [buttons]="['حسناً']"
  (didDismiss)="showError.set(false)"
></ion-alert>